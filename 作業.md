
#### 作業

-- 商品資料表
CREATE TABLE products (
    name VARCHAR(100),           -- 商品名稱
    price INTEGER,              -- 原價
    discount_price INTEGER,      -- 折扣價
    stock INTEGER,              -- 庫存數量
    category VARCHAR(50),        -- 商品類別
    status VARCHAR(20)          -- 商品狀態（上架、下架）
);

INSERT INTO products (name, price, discount_price, stock, category, status) 
VALUES
   ('iPhone 16', 25000, 23000, 50, '3C', 'active'),
   ('AirPods', 5000, 5000, 5, '3C', 'inactive'),
   ('iPad', 18000, 16000, 25, '3C', 'active'),
   ('充電線', 500, 500, 100, '配件', 'active'),
   ('手機殼', 300, 250, 30, '配件', 'active'),
   ('螢幕保護貼', 200, 180, 150, '配件', 'active'),
   ('手機支架', 400, 400, 0, '配件', 'inactive');


~! 新增
INSERT INTO products (name, price, discount_price, stock, category, status) 
VALUES
  ('刪除資料', 25000, 23000, 0, '3C', 'inactive'),
  ('更新資料', 25000, 23000, 0, '3C', 'active');
// -- SELECT * FROM products


~! 查詢 
SELECT name,price,discount_price,stock
FROM products
WHERE category = '3C';


~! 更新
UPDATE products
SET
  price = 9000,
  discount_price = 1000
WHERE name = '更新資料'
// -- SELECT * FROM products


~! 刪除
DELETE FROM products
WHERE
  stock = 0
  AND status = 'inactive';
// -- SELECT * FROM products


/------------------
~! Join、ON：合併資料表
~! 新增
-- 建立部門資料表
CREATE TABLE teams (
  -- serial 序號
  id SERIAL PRIMARY KEY,   -- 部門編號
  name VARCHAR(50)         -- 部門名稱
);

-- 建立員工資料表
CREATE TABLE users (
  -- 主鍵 PRIMARY
  id SERIAL PRIMARY KEY,   
  name VARCHAR(50),
  salary INTEGER,
  team_id INTEGER,
  -- 外來鍵 foreign / 參考 references
  -- 設定外來鍵關聯
  FOREIGN KEY (team_id) REFERENCES teams(id)
);

// ~INSERT
INSERT INTO teams (name) 
VALUES
  ('開發部'),
  ('人事部');
// -- SELECT * FROM teams

INSERT INTO users (name,salary,team_id) 
VALUES
  ('張小明', 45000, 1),
  ('王大明', 48000, 1),
  ('李小華', 52000, 2),
  ('陳小玉', 55000, 2),
  ('林小豪', 47000, 1);
// -- SELECT * FROM users


// ~inner join，進行合併資料表
SELECT 
  users.id,
  users.name,
  users.salary,
  -- 注意 要使用合併表的欄位
  teams.name AS teamname 
FROM users
-- INNER JOIN teams : 插入 teams表
-- ON : 指定了兩個表格之間的關聯條件
INNER JOIN teams ON users.team_id = teams.id

// result
| id | name   | salary | teamname |
|----|--------|--------|----------|
| 1  | 張小明 | 45000  | 開發部   |
| 2  | 王大明 | 48000  | 開發部   |
| 3  | 李小華 | 52000  | 人事部   |
| 4  | 陳小玉 | 55000  | 人事部   |
| 5  | 林小豪 | 47000  | 開發部   |




#### 小節作業
https://miro.com/app/board/uXjVLMcM_hQ=/
https://hackmd.io/CaXirTNnRzyh2XshoCOnMQ
https://codepen.io/shr-huan-huang/pen/abeKGxM?editors=0010


// msg: 作業一：拯救明華國小的資料庫，哪個欄位適合變成外來鍵?
```jsx
學生編號(id)	姓名(name)	班級(class)	性別(gender)	年齡(age)
1	小明	三年一班	男	8
2	小華	三年二班	女	9
3	小美	三年一班	男	8
4	小強	三年一班	女	8
5	小智	三年二班	男	9
```

-- 建立班級資料表
CREATE TABLE classes (
  id SERIAL PRIMARY KEY, -- 班級編號，主鍵
  name VARCHAR(50) -- 班級名稱
);
-- 建立性別資料表
CREATE TABLE genders (
  id SERIAL PRIMARY KEY, -- 性別編號，主鍵
  name VARCHAR(10) -- 性別名稱
);
-- 建立學生資料表
CREATE TABLE students (
  id SERIAL PRIMARY KEY, -- 學生編號，主鍵
  name VARCHAR(20), -- 姓名
  grade INTEGER, -- 班級
  gender INTEGER, -- 性別
  age INTEGER, -- 年齡
  FOREIGN KEY (grade) REFERENCES classes(id),
  FOREIGN KEY (gender) REFERENCES genders(id)
);

// ~新增資料
-- 新增班級資料
INSERT INTO
  classes (name)
VALUES
  ('三年一班'),
  ('三年二班');

-- 新增性別資料
INSERT INTO
  genders (name)
VALUES
  ('男'),
  ('女');
  
-- 新增學生資料
INSERT INTO
  students (name, grade, gender, age)
VALUES
  ('小明', 1, 1, 8),
  ('小華', 2, 2, 9),
  ('小美', 1, 1, 8),
  ('小強', 1, 2, 8),
  ('小智', 2, 1, 9);

// -- SELECT * FROM classes
// -- SELECT * FROM genders
// -- SELECT * FROM students

// ~inner join，進行合併資料表
SELECT 
  students.id AS 學生編號,
  students.name AS 姓名,
  -- 注意 要使用合併表的欄位
  classes.name AS 班級,
  genders.name AS 性別,
  students.age AS 年齡 
FROM students
-- INNER JOIN teams : 插入 teams表
-- ON : 指定了兩個表格之間的關聯條件
INNER JOIN classes ON students.grade = classes.id
INNER JOIN genders ON students.gender = genders.id



// msg: 作業二：多了一個班級老師
```jsx
學生編號	姓名	班級	班級老師	性別	年齡
1	小明	三年一班	  廖洧杰	男	8
2	小華	三年二班	  卡斯柏	女	9
3	小美	三年一班	  查理	  男	8
4	小強	三年一班	  麥可	  女	8
5	小智	三年二班	  李燕容	男	9
```

-- 建立班級資料表
CREATE TABLE classes (
  id SERIAL PRIMARY KEY, -- 班級編號，主鍵
  name VARCHAR(50) -- 班級名稱
);
-- 建立性別資料表
CREATE TABLE genders (
  id SERIAL PRIMARY KEY, -- 性別編號，主鍵
  name VARCHAR(10) -- 性別名稱
);
-- 建立學生資料表
CREATE TABLE students (
  id SERIAL PRIMARY KEY, -- 學生編號，主鍵
  name VARCHAR(20), -- 姓名
  grade INTEGER, -- 班級
  teacher INTEGER, -- 指導老師
  gender INTEGER, -- 性別
  age INTEGER, -- 年齡
  FOREIGN KEY (grade) REFERENCES classes(id),
  FOREIGN KEY (teacher) REFERENCES teachers(id),
  FOREIGN KEY (gender) REFERENCES genders(id)
);
-- 建立指導老師資料表
CREATE TABLE teachers (
  id SERIAL PRIMARY KEY, -- 教師編號，主鍵
  name VARCHAR(50) -- 教師姓名
);

// ~新增資料
-- 新增班級資料
INSERT INTO
  classes (name)
VALUES
  ('三年一班'),
  ('三年二班');

-- 新增性別資料
INSERT INTO
  genders (name)
VALUES
  ('男'),
  ('女');

-- 新增學生資料
INSERT INTO
  students (name, grade, teacher, gender, age)
VALUES
  ('小明', 1, 1, 1, 8),
  ('小華', 2, 2, 2, 9),
  ('小美', 1, 3, 1, 8),
  ('小強', 1, 4, 2, 8),
  ('小智', 2, 5, 1, 9);

-- 新增教師資料
INSERT INTO
  teachers (name)
VALUES
  ('廖洧杰'),
  ('卡斯柏'),
  ('查理'),
  ('麥可'),
  ('李燕容');

// -- SELECT * FROM classes
// -- SELECT * FROM genders
// -- SELECT * FROM students
// -- SELECT * FROM teachers

// ~inner join，進行合併資料表
SELECT 
  students.id AS 學生編號,
  students.name AS 姓名,
  -- 注意 要使用合併表的欄位
  classes.name AS 班級,
  genders.name AS 性別,
  teachers.name AS 班級老師,
  students.age AS 年齡 
FROM students
-- INNER JOIN teams : 插入 teams表
-- ON : 指定了兩個表格之間的關聯條件
INNER JOIN classes ON students.grade = classes.id
INNER JOIN genders ON students.gender = genders.id
INNER JOIN teachers ON students.teacher = teachers.id


// msg: 作業三：小孩的家庭歸類資料庫
```jsx
小孩編號	姓名	父母名稱	父母電話	父母性別
1	小明	王大祥	0973254254	男
2	小華	王曉茹	0955717855	女
3	小美	王大祥	0973254254	男
4	小強	王曉茹	0955717855	女
5	小智	王大祥	0973254254	男
```

-- 建立家長資料表
CREATE TABLE parents (
  id SERIAL PRIMARY KEY,
  name VARCHAR(30),
  phone VARCHAR(50),
  gender VARCHAR(10)
);
-- 建立學生資料表
CREATE TABLE students (
  id SERIAL PRIMARY KEY,
  name VARCHAR(30),
  parent_id INTEGER,
  FOREIGN KEY (parent_id) REFERENCES parents(id)
);

// ~新增資料
-- 新增父母資料
INSERT INTO
  parents (name, phone, gender)
VALUES
  ('王大祥', '0973254254', '男'),
  ('王曉茹', '0955717855', '女');

-- 新增學生資料
INSERT INTO
  students (name, parent_id)
VALUES
  ('小明', 1),
  ('小華', 2),
  ('小美', 1),
  ('小強', 2),
  ('小智', 1);

// -- SELECT * FROM parents
// -- SELECT * FROM students

// ~inner join，進行合併資料表
SELECT 
  students.id AS 小孩編號,
  students.name AS 姓名,
  -- 注意 要使用合併表的欄位
  parents.name AS 父母名稱,
  parents.phone AS 父母電話,
  parents.gender AS 父母性別 
FROM students
-- INNER JOIN teams : 插入 teams表
-- ON : 指定了兩個表格之間的關聯條件
INNER JOIN parents ON students.parent_id = parents.id


// msg: 作業四: 承作業一，學校多開設三年三班，並來了三位新同學
```jsx
學生編號(id)	姓名(name)	班級(class)	性別(gender)	年齡(age)
1	小明	三年一班	男	8
2	小華	三年二班	女	9
3	小美	三年一班	男	8
4	小強	三年一班	女	8
5	小智	三年二班	男	9

// 新增 三年三班 三位新同學
第一位 小新、男、8 歲、三年三班
第二位 小巧、女、8 歲、三年一班
第三位 小凱、男、9 歲、三年二班
```

-- 建立班級資料表
CREATE TABLE classes (
  id SERIAL PRIMARY KEY, -- 班級編號，主鍵
  name VARCHAR(50) -- 班級名稱
);
-- 建立性別資料表
CREATE TABLE genders (
  id SERIAL PRIMARY KEY, -- 性別編號，主鍵
  name VARCHAR(10) -- 性別名稱
);
-- 建立學生資料表
CREATE TABLE students (
  id SERIAL PRIMARY KEY, -- 學生編號，主鍵
  name VARCHAR(20), -- 姓名
  grade INTEGER, -- 班級
  gender INTEGER, -- 性別
  age INTEGER, -- 年齡
  FOREIGN KEY (grade) REFERENCES classes(id),
  FOREIGN KEY (gender) REFERENCES genders(id)
);

// ~新增資料
-- 新增班級資料
INSERT INTO
  classes (name)
VALUES
  ('三年一班'),
  ('三年二班');

-- 新增性別資料
INSERT INTO
  genders (name)
VALUES
  ('男'),
  ('女');
  
-- 新增學生資料
INSERT INTO
  students (name, grade, gender, age)
VALUES
  ('小明', 1, 1, 8),
  ('小華', 2, 2, 9),
  ('小美', 1, 1, 8),
  ('小強', 1, 2, 8),
  ('小智', 2, 1, 9);

// -- SELECT * FROM classes
// -- SELECT * FROM genders
// -- SELECT * FROM students

!新增三位同學
-- 新增班級資料
INSERT INTO
  classes (name)
VALUES
  ('三年三班');

-- 新增學生資料
INSERT INTO
  students (name, grade, gender, age)
VALUES
  ('小新', 3, 1, 8),
  ('小巧', 1, 2, 8),
  ('小凱', 2, 1, 9);

// ~inner join，進行合併資料表
SELECT 
  students.id AS 學生編號,
  students.name AS 姓名,
  -- 注意 要使用合併表的欄位
  classes.name AS 班級,
  genders.name AS 性別,
  students.age AS 年齡 
FROM students
-- INNER JOIN teams : 插入 teams表
-- ON : 指定了兩個表格之間的關聯條件
INNER JOIN classes ON students.grade = classes.id
INNER JOIN genders ON students.gender = genders.id
